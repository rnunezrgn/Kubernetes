---
# Worker Node Join
- name: Load br_netfilter module immediately
  ansible.builtin.modprobe:
    name: br_netfilter
    state: present

- name: Ensure br_netfilter loads on boot
  ansible.builtin.copy:
    dest: /etc/modules-load.d/br_netfilter.conf
    content: "br_netfilter\n"
    mode: '0644'

- name: Configure sysctl for Kubernetes networking
  ansible.builtin.copy:
    dest: /etc/sysctl.d/k8s.conf
    content: |
      net.bridge.bridge-nf-call-ip6tables = 1
